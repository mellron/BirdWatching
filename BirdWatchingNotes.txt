# Import the WebAdministration module to interact with IIS
Import-Module WebAdministration

# Define the application pool name
$poolName = "Employee Directory"

# Retrieve and format the SID for the application pool
$poolSid = (Get-ItemProperty "IIS:\AppPools\$poolName").processModel.identityType
if ($poolSid -eq "ApplicationPoolIdentity") {
    $poolSid = [System.Security.Principal.SecurityIdentifier]::new("S-1-5-82-" + [System.Security.Cryptography.HashAlgorithm]::Create("SHA1").ComputeHash([System.Text.Encoding]::Unicode.GetBytes($poolName)).Take(5).ForEach({$_.ToString("x2")}) -join "")
    Write-Output "Application Pool SID: $poolSid"
} else {
    Write-Output "Application Pool uses a custom identity: $poolSid"
}
